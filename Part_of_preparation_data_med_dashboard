#загрузка библиотек
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px
import numpy as np
import warnings 
warnings.filterwarnings('ignore')

pd.set_option('max_colwidth', None)
table_12 = pd.read_excel('2021_Таблица_012_Злокачественные_новообразования_в_РФ.xlsx', header=[0,1,2,3,4,5,6])
table_12.head()

#удалим верхние части многоуровневых заголовков
table_12 = table_12.droplevel(0, axis=1)
table_12 = table_12.droplevel(0, axis=1)
table_12 = table_12.droplevel(0, axis=1)
table_12 = table_12.droplevel(0, axis=1)

table_12.head()

# переименование колонок
table_12.columns = ['Регион', 'Все население, абсолютное число', 'Все население, показатель на 100 тыс.,грубый', 
             'Все население, показатель на 100 тыс.,стандарт','Все население, показатель на 100 тыс.,ошибка',
             'Мужчины, абсолютное число','Мужчины, показатель на 100 тыс.,грубый','Мужчины, показатель на 100 тыс.,стандарт',
             'Мужчины, показатель на 100 тыс.,ошибка', 'Женщины, абсолютное число','Женщины, показатель на 100 тыс.,грубый',
             'Женщины, показатель на 100 тыс.,стандарт','Женщины, показатель на 100 тыс.,ошибка']

#удалим грубые показатели и доли ошибки, т.к. их использование в визуализации не является необходимым
del table_12['Все население, показатель на 100 тыс.,ошибка']
del table_12['Мужчины, показатель на 100 тыс.,ошибка']
del table_12['Женщины, показатель на 100 тыс.,ошибка']

del table_12['Все население, показатель на 100 тыс.,грубый']
del table_12['Мужчины, показатель на 100 тыс.,грубый']
del table_12['Женщины, показатель на 100 тыс.,грубый']

#удалим строки с названиями страны и фед.округов, поскольку нас интересует разбивка по регионам
table_12.drop(labels = [0],axis = 0, inplace = True)
table_12.drop(labels = [1,20,32,41,49,64,71,82],axis = 0, inplace = True)

#добавим столбец с локализацией образований
table_12.insert (0, 'Локализация', 0)
table_12 = table_12.assign(Локализация='Злокачественные новообразования - всего (С00-96)')

#сплавляем данные, разделенные по половому признаку и добавляем отдельный столбец с гендером
table_12_melt = table_12.melt(id_vars=['Регион','Локализация'],
     value_vars=['Все население, абсолютное число', 'Все население, показатель на 100 тыс.,стандарт',
                 'Мужчины, абсолютное число', 'Мужчины, показатель на 100 тыс.,стандарт','Женщины, абсолютное число',
                 'Женщины, показатель на 100 тыс.,стандарт'])
table_12_melt.head()

table_12_melt.rename(columns={'variable': 'Показатель', 'value': 'Значение'})

# проверяем наличие явных дубликатов
table_12_melt.duplicated().sum()

# проверяем наличие пропусков
table_12_melt.isna().sum()

#сохраняем файл для дальнейшей визуализации
table_12_melt.to_csv(r"K:/table_12_melt.csv", index=False)

